# 개략적인 규모 추정

> 보편적으로 통되는 성능 수치상에서 사고실험을 행하여 추정치를 계산하는 행위
> 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것
>

## 규모 확장성을 표현하는데 필요한 기본기 3가지
1. 2의 제곱수
2. 응답지연 값
3. 가용성

### 2의 제곱수
- 데이터 볼륨의 단위를 2의 제곱수로 표현
- 최소 단위 1바이트(8비트)


| 2의 x 제곱 | 근사치   | 이름     | 축약형 |
|---------|-------|--------|-----|
| 10      | 1천    | 1킬로바이트 | 1KB |
| 20      | 1백만   | 1메가바이트 | 1MB |
| 30      | 10억   | 1기가바이트 | 1GB |
| 40      | 1조    | 1테라바이트 | 1TB |
| 50      | 1000조 | 1페티바이트 | 1PB |

### 응답지연 값

- 메모리는 빠르지만 디스크는 아직도 느리다
- 디스크 탐색은 가능한 한 피해라
- 단순한 압축 알고리즘은 빠르다
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라
- 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다

### 가용성에 관계된 수치들

- 고가용성 : 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어
- 표현: % -> 9가 많으면 많을 수록 좋음 / 대부분의 서비스는 99%~100%
- SLA(Service Level Agreement) : 서비스 사업자와 고객 사이에 맺어진 합의 / 이 합의에 가용시간 기술

### 예제 : 트위터 QPS와 저장소 요구량 추정

**가정** 

- 월간 능동 사용자는 3억명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10%정도다.
- 데이터는 5년간 보관된다.

**추정**

**QPS(Query Per Second) 추정치**
- 일간 능동 사용자 = 월간 능동 사용자 * 일간 사용 비율
  - 3억 * 50% = 1.5억명
  
- QPS =QPS = 일간 능동 사용자 * 평균 글 작성 수(Query 발생) / 24시간 / 3600초 
  - 1.5억 명 * 2 / 24시간 / 3600초 = 약 3500 QPS

- 최대 QPS = 2 * QPS 
  - 약 3500 QPS * 2 = 약 7000 QPS (Peek QPS)

**미디어 저장을 위한 저장소 요구량**
- 평균 트윗 크기
  - tweet_id에 64바이트
  - 텍스트에 140바이트
  - 미디어에 1MB

- 미디어 저장소 요구량 = 일간 능동 사용자 * 평균 글 작성 수 * 미디어 포함 콘텐츠 비율 * 미디어 크기
  - 1.5억 * 2 * 10% * 1MB = 30TB/일
  
- 5년간 미디어를 보관하기 위한 저장소 요구량 = 30TB *365 * 5 = 약 55PB

## 추가 개념)

QPS(Query Per Second)

QPS는 초당 서버가 응답할 수 있는 쿼리의 수를 나타낸다.
일반적으로 웹 서비스에서 검색 엔진이나 DB와 같은 특정 서버가 처리할 수 있는 트래픽의 수를 가리킨다.
FaceBook 같은 경우에는 초당 천만 건 정도의 쿼리를 처리할 수 있다.


TPS(Transaction Per Second)

TPS는 초당 처리할 수 있는 트랜잭션의 수를 나타낸다.
이는 특정 엔티티가 수행한 원자적 동작의 수를 말하며, 일반적으로 DB의 트랜잭션 수(Rollback과 Commit)를 말한다.
클라이언트 요청 → 서버 내부 처리 → 응답 까지가 하나의 TPS라고 볼 수 있다.


QPS와 TPS는 아주 비슷하지만 조금 다르다.

예를 들어 우리가 어떤 페이지를 방문한다고 생각해보자.
이때 방문한 페이지에는 게시글, 댓글, 광고, 인기 글 등의 정보들이 보인다고 하자.

우리가 페이지를 방문하면 하나의 TPS가 발생한다.
하지만 실제로는 게시글 조회, 댓글 조회, 광고 조회, 인기글 조회 등 4번의 특정 서버 요청이 발생하게 되고
이것을 QPS라고 볼 수 있다. 즉, 1 TPS와 4 QPS가 형성된다.

하지만 회원가입과 같은 단일 요청의 경우 하나의 쿼리만 발생하므로 TPS와 QPS는 같다고 볼 수 있다.

각 서비스의 특성상 중요한 성능 지표가 따로 있을 것이므로 해당 지표를 선택해 시스템의 개략적 성능 규모 측정을 하는 것이 바람직하다.

